:root {
  --bg: #0b1630;
  --bg-2: #0e1d3f;
  --gold: #d6b25e;
  --gold-2: #b9913a;
  --ink: #e6eaf5;
  --muted: #95a3c1;
  --error: #ff6b6b;
  --ok: #37c48f;
  --card-shadow: 0 14px 28px rgba(0,0,0,.22), 0 6px 12px rgba(0,0,0,.18);
}

.layout {
  display: grid;
  grid-template-columns: 72px 1fr 360px;
  min-height: 100vh;
  background: linear-gradient(180deg, var(--bg), var(--bg-2));
  color: var(--ink);
}

/* Rail */
.rail {
  border-right: 1px solid rgba(214,178,94,.25);
  padding: .75rem .5rem;
  display: flex; flex-direction: column; align-items: center; gap: .75rem;

  .rail-dot {
    width: 14px; height: 14px; border-radius: 50%;
    border: 2px solid var(--gold);
    box-shadow: inset 0 0 0 2px rgba(0,0,0,.5);
  }
  .rail-title { writing-mode: vertical-rl; transform: rotate(180deg); letter-spacing: .08em; color: var(--gold); font-weight: 700; }

  .rail-status { margin-top: 1rem; text-align: center; font-size: .85rem;
    .dot { display:inline-block; width:.55rem;height:.55rem;border-radius:50%; background: var(--gold); animation: pulse 1s infinite; }
    .ok { color: var(--ok); } .error { color: var(--error); display:block; margin:.25rem 0; }
  }

  .rail-controls { margin-top: auto; display:flex; flex-direction:column; gap:.5rem; width:100%;
    select, button {
      width: 100%;
      background: rgba(255,255,255,.06);
      color: var(--ink);
      border: 1px solid rgba(214,178,94,.35);
      border-radius: 10px;
      padding: .45rem .5rem;
    }
    .free-controls { display: grid; gap: .4rem; margin-top: .25rem;
      .seg { display:flex; gap:.25rem; }
      .seg button { flex:1; }
    }
    button[disabled] { opacity: .6; cursor: not-allowed; }
  }
}

/* Board */
.board {
  position: relative;
  background-size: cover;
  background-position: center;
  overflow: hidden;

  &::after{
    content:"";
    position:absolute; inset:0;
    background: radial-gradient(ellipse at center, rgba(0,0,0,.35), rgba(0,0,0,.55) 70%);
    pointer-events:none;
  }
}

.layer-tabs {
  position: absolute; top: .5rem; left: 50%; transform: translateX(-50%);
  display: flex; gap: .5rem; z-index: 3;
  .layer-chip {
    background: rgba(255,255,255,.08);
    color: var(--ink);
    border: 1px solid rgba(214,178,94,.35);
    border-radius: 999px;
    padding: .2rem .6rem;
  }
  .active { background: rgba(214,178,94,.25); border-color: var(--gold); }
}

.layer-overlay {
  position: absolute; inset: 0; background: rgba(0,0,0,.45);
  animation: layerFade .45s ease;
  z-index: 2; pointer-events: none;
}

@keyframes layerFade { from { opacity: 0 } to { opacity: 1 } }

.slot, .card {
  --x: 50%;
  --y: 50%;
  --r: 0deg;
  position: absolute;
  left: var(--x);
  top: var(--y);
  transform: translate(-50%, -50%) rotate(var(--r));
}

.slot {
  width: min(16vw, 220px);
  aspect-ratio: 2.5 / 4;
  border: 2px dashed rgba(214,178,94,.35);
  border-radius: 16px;
  filter: drop-shadow(0 8px 18px rgba(0,0,0,.25));
  transition: border-color .2s ease;
  z-index: 1;
  &:hover { border-color: var(--gold); }
  &::after {
    content: attr(data-pos);
    position: absolute; top: -10px; left: -10px;
    background: rgba(11,22,48,.85); color: var(--gold);
    border: 1px solid rgba(214,178,94,.5); border-radius: 10px;
    padding: .1rem .35rem; font-size: .8rem;
  }
}

/* Cartas + animaciones */
.card {
  width: min(16vw, 220px);
  aspect-ratio: 2.5 / 4;
  transform-style: preserve-3d; perspective: 1000px;
  transition: transform 320ms ease, filter 200ms ease;
  z-index: 3;

  /* animación de entrada desde la “pila” (centro) */
  opacity: 0;
  animation: dealIn 380ms ease forwards;
  animation-delay: var(--delay-ms, 0ms);

  img { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; border-radius: 14px; backface-visibility: hidden; }
  .front { transform: rotateY(180deg); }
  .back  { transform: rotateY(0deg); filter: brightness(.92) contrast(1.05); }

  &.faceup .front { transform: rotateY(0deg); }
  &.faceup .back  { transform: rotateY(180deg); }

  &.dealt { filter: drop-shadow(var(--card-shadow)); }
  &:hover { transform: translate(-50%, -50%) rotate(var(--r)) scale(1.03); }
  &.reversed { transform: translate(-50%, -50%) rotate(calc(var(--r) + 180deg)); }

  .pos-badge {
    position: absolute; bottom: -10px; right: -10px;
    background: rgba(214,178,94,.92); color: #1b1b1b;
    font-weight: 700; border-radius: 999px; padding: .1rem .45rem; font-size: .78rem;
    border: 1px solid rgba(0,0,0,.35);
  }
}

@keyframes dealIn {
  0%   { opacity: 0; transform: translate(-50%, -50%) scale(.8) rotate(calc(var(--r) - 10deg)); }
  100% { opacity: 1; transform: translate(-50%, -50%) rotate(var(--r)); }
}

/* CDK Drag styles */
.cdk-drag-preview {
  box-shadow: 0 12px 18px rgba(0,0,0,.35);
  border-radius: 14px;
}
.cdk-drag-placeholder {
  opacity: .2;
}
.cdk-drag-animating {
  transition: transform .2s ease;
}

/* Panel derecho */
.panel {
  border-left: 1px solid rgba(214,178,94,.25);
  display: grid; grid-template-rows: auto 1fr auto;
  background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
  h3 { margin: 1rem; color: var(--gold); }
  .panel-body { padding: 0 1rem 1rem; overflow: auto; }
  .panel-footer { border-top: 1px solid rgba(214,178,94,.25); padding: .75rem 1rem; display:flex; gap:.5rem; justify-content:flex-end;
    button { background: rgba(255,255,255,.06); color: var(--ink); border: 1px solid rgba(214,178,94,.35); border-radius: 10px; padding: .45rem .75rem; }
  }
  .muted { color: var(--muted); } .rev { color: var(--gold); }
}

@keyframes pulse { 0%,100%{transform:scale(1);opacity:.75} 50%{transform:scale(1.2);opacity:1} }

@media (max-width: 1100px) { .layout { grid-template-columns: 60px 1fr 300px; } }
@media (max-width: 860px)  {
  .layout { grid-template-columns: 1fr; }
  .rail { flex-direction: row; justify-content: space-between; border-right: none; border-bottom: 1px solid rgba(214,178,94,.25); }
  .panel { order: 3; } .board { order: 2; min-height: 60vh; }
}
